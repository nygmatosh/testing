from django.db import models

class Comment(models.Model):
    user = models.CharField(max_length=100)  # Или ForeignKey к User
    text = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)

    # Вложенность (ответ на другой комментарий)
    parent = models.ForeignKey(
        'self',
        on_delete=models.CASCADE,
        null=True,
        blank=True,
        related_name='replies'
    )

    def __str__(self):
        return f'{self.user}: {self.text[:30]}'

    class Meta:
        ordering = ['created_at']





# Добавление корневого комментария
c1 = Comment.objects.create(user='Anonym', text='Первый комментарий')

# Ответ на него
c2 = Comment.objects.create(user='Rum_8', text='Ответ на первый', parent=c1)

# Ответ на ответ
c3 = Comment.objects.create(user='Anonym', text='Ответ на Rum_8', parent=c2)





{% for comment in comments %}
    <div style="margin-left: {{ level|default:0 }}px;">
        <p><strong>{{ comment.user }}</strong>: {{ comment.text }}</p>

        {% if comment.replies.all %}
            {% include "comment_partial.html" with comments=comment.replies.all level=level|add:20 %}
        {% endif %}
    </div>
{% endfor %}






def comments_view(request):
    comments = Comment.objects.filter(parent=None)
    return render(request, 'comments.html', {'comments': comments})
